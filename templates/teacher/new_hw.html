<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=2.0"> {% load staticfiles %}
    <title>浙江大学教学服务系统</title>
    <!-- 使用本地的样式与js文件 -->
    <script src="{%  static 'js/jquery-3.2.1.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'Semantic-UI-master/dist/semantic.min.css' %}">
    <script type="text/javascript" src="{% static 'Semantic-UI-master/dist/semantic.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'Semantic-UI-master/dist/calendar.min.js' %}"></script>
    <link rel="stylesheet" href="{% static 'Semantic-UI-master/dist/calendar.min.css' %}">
    <!--脚本-->
    <script>
        $(document).ready(function () {
            //tab切换脚本
            $('.ui .item[data-tab]').on('click', function () {
                $('.ui .item[data-tab]').removeClass('active');
                $(this).addClass('active');
                var tab = $(this).attr("data-tab");
                $(".tab.segment").removeClass("active");
                $(".tab.segment[data-tab=\"" + tab + "\"]").addClass("active");
            });
            //下拉菜单初始化脚本
            $('.ui .dropdown').dropdown();
        });


    </script>
    <!--初始化与修改函数-->
    <script>
        //初始化本课程学生作业完成情况表
        function init_list() {
            var list_td = [];  //表格每栏的内容，学号、姓名从后台获取
            list_td[0] = '3150100000';       //此处初始化用于测试
            list_td[1] = '王泽杰';
            list_td[2] = '';        //最后提交时间设置为无
            list_td[3] = '<button class="ui button" onclick="modify_row(this)">批改</button>';   //按钮必须初始化
            var tbody = document.getElementById('list');   //tbody标签
            var tr;                         //表格tr标签
            var td = [];                    //表格td标签
            for (var i = 0; i < 10; i++) {        //此处设置学生为10名，实际要从后台获得
                tr = document.createElement('tr');
                tbody.appendChild(tr);    //创建tr标签并加入tbody中
                for (var j = 0; j < 4; j++) {
                    td[j] = document.createElement('td');
                    td[j].innerHTML = list_td[j];
                    tr.appendChild(td[j]);      //创建四个td标签并加入tr中
                }
                td[0].className = 'collapsing';
                td[1].className = 'collapsing';
                td[3].className = 'right aligned collapsing';   //设置第0、1、3、4个td的class
                td[3].childNodes[0].setAttribute('disabled', 'true');   //设置按钮为不可用
            }
        }
        //增加判断题
        function add_tof() {
            var question;
            var answer;
            //tof[0] = f.childNodes[1].childNodes[3].value;   //获取问题b内容，由于chilenodes把换行也算作一个node，因此此处节点从1开始
            question = document.getElementById('tof_question').value; //获取问题b的内容
            var tmp = question.trim();
            if (tmp === '') {     //判断是否全是空格、回车，如果是就警告并终止保存，重新输入
                alert('请输入问题内容');
                return false;
            }
            if (document.getElementById('T').checked === true) {
                answer = 'T';   //设置答案为T
            }
            else if (document.getElementById('F').checked === true) {
                answer = 'F';   //设置答案为F
            }
            else {
                alert('请选择答案');
                return false;
            }
            //将题目与答案上传到数据库
            //....
            window.location.reload();   //刷新页面
        }
        //添加选项
        var option_num = 0;     //选项个数,初始为0
        function add_option(b) {
            option_num++;       //将选项个数加1
            if (option_num > 4) {
                option_num--;
                alert('最多只能设置4个选项');
                return false;
            }
            b.innerHTML = "保存选项";       //把按钮改成保存选项
            b.setAttribute('onclick', 'save_option(this)');


            var tbody = document.getElementById('options');       //获得tbody标签
            var tr;     //表格tr标签
            var td = [];    //表格td标签
            tr = document.createElement('tr');
            tbody.appendChild(tr);      //创建tr标签并加入tbody中
            for (var i = 0; i < 2; i++) {
                td[i] = document.createElement('td');
                tr.appendChild(td[i]);      //创建2个td标签并加入tr中
            }
            td[0].setAttribute('id', 'option_text' + option_num + '');
            td[1].className = 'right aligned collapsing';   //设置第1个td的class
            td[1].innerHTML = '<div class="ui button" onclick="del_option(this)">删除选项</div>'
            tr.setAttribute('contentEditable', 'true');  //使当前行可编辑
            td[1].setAttribute('contentEditable', 'false');  //使得按钮对应的列不可修改
        }
        //删除选项
        function del_option(r) {
            option_num--;
            var i = r.parentNode.parentNode.rowIndex;
            document.getElementById('options_table').deleteRow(i);
        }
        //保存选项
        function save_option(b) {
            var tmp = document.getElementById('option_text' + option_num + '').innerHTML.replace(/[ ]|[&nbsp;]|[<br>]/g, '');
            if (tmp === '') {     //判断是否全是空格、回车，如果是就警告并终止保存，重新输入
                alert('请输入选项内容');
                return false;
            }
            var td = document.getElementById('option_text' + option_num + '');
            td.setAttribute('contentEditable', 'false');  //使当前行可编辑
            var checkbox = document.createElement('div');
            checkbox.setAttribute('class', 'ui radio checkbox');
            checkbox.innerHTML = '<input type="radio" name="option1" id="option' + option_num + '">';
            var label = document.createElement('label');
            checkbox.appendChild(label);
            label.innerHTML = td.innerHTML;
            label.setAttribute('id', "option_label" + option_num);
            td.innerHTML = '';
            td.appendChild(checkbox);    //创建checkbox并加入本选项的表格项中
            b.innerHTML = "添加选项";           //把按钮改回添加选项
            b.setAttribute('onclick', 'add_option(this)');
        }
        //增加选择题
        function add_choice() {
            var question = document.getElementById('choice_question').value;    //获取问题内容
            var tmp = question.trim();
            if (tmp === '') {     //判断是否全是空格、回车，如果是就警告并终止保存，重新输入
                alert('请输入问题内容');
                return false;
            }
            var option = [];        //选项
            var answer = "no";             //答案
            var j;
            for (var i = 0; i < option_num; i++) {
                j = i + 1;
                option[i] = document.getElementById('option_label' + j + '').innerText;  //label的id从1开始，因此此处为i+1
                if (document.getElementById('option' + j + '').checked === true) {
                    answer = option[i];
                }
            }
            if (answer === 'no')
                alert('请选择一个答案！');
            else {
                //将题目及选项、答案上传到数据库
                //......
                window.location.reload();   //刷新页面
            }
        }
        //增加简答题
        function add_other() {
            var question = document.getElementById('other_question').value;
            var tmp = question.trim();
            if (tmp === '') {     //判断是否全是空格、回车，如果是就警告并终止保存，重新输入
                alert('请输入问题内容');
                return false;
            }
            //添加到数据库
            //......
            window.location.reload();
        }
        //通知学生完成作业函数
        function inform() {
            //通过后台向学生发送通知
            //...
            alert('通知发送成功');
        }
        //初始化ddl
        function init_ddl() {
            var ddl = document.getElementById('ddl').value;
            if (ddl === '')      //如果ddl未设置，则弹窗先设置ddl
                set_ddl();
        }
        //设置ddl
        function set_ddl() {
            $("#setddl").modal('setting', 'closable', false).modal('show'); //必须点击保存才可以关闭
            $('#example1').calendar({ disableMinute: true });
        }
        //保存ddl
        function save_ddl() {
            var ddl = document.getElementById('ddl').value;
            if (ddl === '') {
                alert('请选择ddl');
                return false;
            }
            //将ddl值保存到后台
            //......
            $('.ui .modal').modal('hide');
        }
        //初始化作业名称
        function init_hw_name() {
            document.getElementById('hw_name').innerHTML = "Homework";//设置默认作业名称为Homework
            document.getElementById('hw_name2').innerHTML = "Homework";
        }
        //编辑作业名称
        function modify_hw_name() {
            document.getElementById('hw_text').value = document.getElementById('hw_name').innerHTML;
            $("#setname").modal('setting', 'closable', false).modal('show');
        }
        //保存作业名称
        function save_hw_name() {
            var hw_name = document.getElementById('hw_text').value;
            var tmp = hw_name.trim();
            if (tmp === '') {     //判断是否全是空格，如果是就警告并终止保存，重新输入
                alert('请输入作业名称');
                return false;
            }
            document.getElementById('hw_name').innerHTML = hw_name;     //修改页面内显示的作业名称
            document.getElementById('hw_name2').innerHTML = hw_name;
            //修改后台相关内容
            //......
            $('.ui .modal').modal('hide');
        }
    </script>

</head>

<body onload="init_list();init_ddl();init_hw_name()">
    <!--这是单选题的模板（4个选项）-->
    <!--div class="grouped fields">
            <label>How often do you use checkboxes?</label>
            <div class="field">
                <div class="ui radio checkbox">
                    <input type="radio"  name="example2">
                    <label>Once a week</label>
                </div>
            </div>
            <div class="field">
                <div class="ui radio checkbox">
                    <input type="radio" name="example2">
                    <label>2-3 times a week</label>
                </div>
            </div>
            <div class="field">
                <div class="ui radio checkbox">
                    <input type="radio" name="example2">
                    <label>Once a day</label>
                </div>
            </div>
            <div class="field">
                <div class="ui radio checkbox">
                    <input type="radio" name="example2">
                    <label>Twice a day</label>
                </div>
            </div>
        </div-->
    <!--顶部菜单栏-->
    <div class="ui fixed red top large menu">
        <a class="active item" data-tab="student_list">完成情况</a>
        <a class="item" data-tab="homework">作业详情</a>
        <div class="ui dropdown link item">
            添加题目
            <i class="dropdown icon"></i>
            <div class="menu">
                <a class="item" data-tab="add_tof">判断题</a>
                <a class="item" data-tab="add_choice">选择题</a>
                <a class="item" data-tab="add_other">简答题</a>
            </div>
        </div>
        <a class="item" onclick="inform()">通知学生</a>
        <a class="item" onclick="set_ddl()">更改ddl</a>
        <div class="right menu">
            <div class="ui search">
                <div class="ui icon input">
                    <input class="prompt" type="text" placeholder="搜索课程或教师">
                    <i class="search icon"></i>
                </div>
            </div>
        </div>
        <a class="item" onclick="window.location.href='http://127.0.0.1:8000/t_index/teacher_courses'">返回</a>
        <a class="item" onclick="window.location.href='http://127.0.0.1:8000'">退出</a>
    </div>
    <!--添加隐藏式分隔符-->
    <div class="ui hidden divider"></div>
    <div class="ui hidden divider"></div>
    <!--学生作业完成情况表-->
    <div class="ui bottom attached active tab segment" data-tab="student_list">
        <div class="ui container">
            <div class="ui form">
                <div class="field">
                    <h2 class="ui header" id="hw_name"></h2>
                </div>
                <button class="ui button" onclick="modify_hw_name()">编辑作业名称</button>
            </div>
            <table class="ui large celled collapsing striped table" id="student_list">
                <thead>
                    <tr>
                        <th>学号</th>
                        <th>姓名</th>
                        <th>最后提交时间</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="list">
                </tbody>
            </table>
        </div>
    </div>

    <!--作业内容-->
    <div class="ui bottom attached tab segment" data-tab="homework">
        <div class="ui container">
            <div class="ui form">
                <div class="field">
                    <h2 class="ui header" id="hw_name2"></h2>
                </div>
                <button class="ui button" onclick="modify_hw_name()">编辑作业名称</button>
            </div>
            <div class="ui form" id="hw_form">
                <!--作业正文-->
            </div>
        </div>
    </div>

    <!--添加判断题-->
    <div class="ui bottom attached tab segment" data-tab="add_tof">
        <div class="ui container">
            <div class="ui form">
                <div class="field">
                    <label>问题内容</label>
                    <textarea rows="4" id="tof_question"></textarea>
                </div>
                <div class="grouped fields">
                    <label>问题答案</label>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input type="radio" name="example2" id="T">
                            <label>T</label>
                        </div>
                    </div>
                    <div class="field">
                        <div class="ui radio checkbox">
                            <input type="radio" name="example2" id="F">
                            <label>F</label>
                        </div>
                    </div>
                </div>
                <button class="ui button" onclick="add_tof()">提交</button>
            </div>
        </div>
    </div>

    <!--添加选择题-->
    <div class="ui bottom attached tab segment" data-tab="add_choice">
        <div class="ui container">
            <div class="ui form">
                <div class="field">
                    <label>问题内容</label>
                    <textarea rows="4" id="choice_question"></textarea>
                </div>
                <div class="grouped fields">
                    <label>问题选项</label>
                    <table class="ui celled striped table" id="options_table">
                        <thead>
                            <tr>
                                <th>内容</th>
                                <th>删除</th>
                            </tr>
                        </thead>
                        <tbody id="options">
                            <!--tr> 课程安排范例
                                    <td class="collapsing">2017.12.12</td>
                                    <td class="collapsing">6,7,8节</td>
                                    <td >第一次上课</td>
                                    <td class="right aligned collapsing">教7-604</td>
                                </tr-->
                        </tbody>
                    </table>
                </div>
                <button class="ui button" onclick="add_option(this)">添加选项</button>
                <button class="ui button" onclick="add_choice()">提交</button>
            </div>
        </div>
    </div>

    <!--添加简答题-->
    <div class="ui bottom attached tab segment" data-tab="add_other">
        <div class="ui container">
            <div class="ui form">
                <div class="field">
                    <label>问题内容</label>
                    <textarea rows="4" id="other_question"></textarea>
                </div>
                <button class="ui button" onclick="add_other()">提交</button>
            </div>
        </div>
    </div>
    <!--设置ddl-->
    <div class="ui test modal" id="setddl">
        <i class="close icon"></i>
        <div class="header">
            请设置本次作业的ddl
        </div>
        <div class="content">
            <div class="ui calendar" id="example1">
                <div class="ui fluid input left icon">
                    <i class="calendar icon"></i>
                    <input class="fluid" type="text" placeholder="Date and Time" id="ddl">
                </div>
            </div>
        </div>
        <div class="actions">
            <div class="ui black button" onclick="save_ddl()">
                保存
            </div>
        </div>
    </div>
    <!--编辑作业名称-->
    <div class="ui test modal" id="setname">
        <i class="close icon"></i>
        <div class="header">
            请设置本次作业的名称
        </div>
        <div class="content">
            <div class="ui fluid input left icon">
                <i class="edit icon"></i>
                <input class="fluid" type="text" id="hw_text">
            </div>
        </div>
        <div class="actions">
            <div class="ui black button" onclick="save_hw_name()">
                保存
            </div>
        </div>
    </div>
</body>

</html>